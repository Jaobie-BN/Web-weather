services:
  # ========================
  # 1. Collector Service (Worker)
  # ========================
  - type: worker
    name: weather-collector
    runtime: docker
    rootDir: collector
    dockerfilePath: ./Dockerfile
    plan: free
    envVars:
      - key: MONGO_URI
        value: "mongodb+srv://<username>:<password>@<cluster>.mongodb.net/weatherdb"
      - key: OPENWEATHER_API_KEY
        sync: false

  # ========================
  # 2. Backend API Service
  # ========================
  - type: web
    name: weather-backend
    runtime: docker
    rootDir: backend
    dockerfilePath: ./Dockerfile
    plan: free   # ✅ บังคับใช้ free plan
    envVars:
      - key: MONGO_URI
        value: "mongodb+srv://<username>:<password>@<cluster>.mongodb.net/weatherdb"
      - key: PORT
        value: "4000"

  # ========================
  # 3. Frontend Service
  # ========================
  - type: web
    name: weather-frontend
    runtime: docker
    rootDir: frontend
    dockerfilePath: ./Dockerfile
    plan: free   # ✅ บังคับใช้ free plan
    envVars:
      - key: PORT
        value: "3000"
      - key: BACKEND_URL
        value: "https://weather-backend.onrender.com"
